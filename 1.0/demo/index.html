<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>DEMO imageFilter的图像处理 </title>
    <script src="http://g.tbcdn.cn/kissy/k/1.3.0/kissy-min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="http://g.tbcdn.cn/kissy/k/1.3.0/css/dpl/base-min.css">

</head>
<body>
    <h2>imageFilter的demo</h2>

    <input type="file" id="J_selectFile" />
    <script>
        var S = KISSY;
        S.Config.debug = true;
        if (S.Config.debug) {
            var srcPath = "../../../";
            S.config({
                packages:[
                    {
                        name:"gallery",
                        path:srcPath,
                        charset:"utf-8",
                        ignorePackageNameInUri:true
                    }
                ]
            });
        }

        S.use('gallery/imageFilter/1.0/index,dom,node', function (S, ImageFilter,Dom,Node) {

            //使用fileAPI读取本地文件
            Node.one("#J_selectFile").on("change",function(e){
                var fileRr = new FileReader();
                fileRr.onload = function(){
                    var imgResult =  fileRr.result;
                    Node.all("img").attr("src",imgResult);
                    updateAllImg();
                }
                fileRr.readAsDataURL(this.files[0]);
            });

            function updateAllImg(){
                new ImageFilter({ imgNode : S.get("#resultImg-1")} ).gray().render().destroy;
                new ImageFilter({ imgNode : S.get("#resultImg-2")} ).setContrast(80,true).render().destroy();
                new ImageFilter({ imgNode : S.get("#resultImg-3")} ).blur(3).render().destroy();
                new ImageFilter({ imgNode : S.get("#resultImg-4")} ).setBrightness(80).render().destroy();
                new ImageFilter({ imgNode : S.get("#resultImg-5")} ).crop(100,100,200,200).render().destroy();
                new ImageFilter({ imgNode : S.get("#resultImg-6")} ).mixBrown().vignetting().render().destroy();
                new ImageFilter({ imgNode : S.get("#resultImg-7")} ).mixColor([117,117,117]).render().destroy();
            }

            updateAllImg();

        });
    </script>

    <style>
        .resultGrid{
            float: left;
            margin-left: 20px;
        }
    </style>

    <div>
        <p>注：</p>
        <p>1.canvas禁止读取跨域图片数据，故无法使用tps地址提供的图片。此处sample使用的是同域图片。</p>
        <p>2.此功能一般在用户上传图片(e.g.头像/晒图)的场景中使用，借用fileAPI（IE 10.0+）直接读取文件也是个不错的办法。或是在图片上传后由服务器端异步返回解码结果，回填到img节点的src属性，再进行处理。</p>
        <p>3.为保证体验流畅，建议一次处理一张图片</p>
        <p>4.兼容性: canvas为IE 9.0+ , fileAPI要求IE10.0+</p>

    </div>

    <div>
        <h3>原图</h3>
        <img src="./sample.jpg" /> <br>
        <hr>
    </div>

    <div class="resultGrid">
        <p>灰度处理</p>
        <img id="resultImg-1" src="./sample.jpg" />
    </div>
    
    <div class="resultGrid">
        <p>对比度调节</p>
        <img id="resultImg-2" src="./sample.jpg" />
    </div>

    <div class="resultGrid">
        <p>高斯模糊</p>
        <img id="resultImg-3" src="./sample.jpg" />
    </div>

    <div class="resultGrid">
        <p>亮度调节</p>
        <img id="resultImg-4" src="./sample.jpg" />
    </div>

    <div class="resultGrid">
        <p>裁剪</p>
        <img id="resultImg-5" src="./sample.jpg" />
    </div>

    <div class="resultGrid">
        <p>做旧，四角压暗</p>
        <img id="resultImg-6" src="./sample.jpg" />
    </div>

    <div class="resultGrid">
        <p>混色</p>
        <img id="resultImg-7" src="./sample.jpg" />
    </div>

</body>

</html>
